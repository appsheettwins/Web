<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡πÇ‡∏°‡∏ó‡∏ô‡∏≤‡∏ö‡∏±‡∏ï‡∏£</title>

<style>
*{box-sizing:border-box;font-family:'Sarabun','Segoe UI',sans-serif}
body{
background:linear-gradient(135deg,#667eea,#764ba2);
padding:14px;min-height:100vh}

.container{max-width:820px;margin:auto}

/* ---------- Card ---------- */
.card{
background:#fff;border-radius:22px;
padding:28px;margin-bottom:20px;
box-shadow:0 20px 45px rgba(0,0,0,.25)}

/* ---------- Form ---------- */
label{font-size:1.15em;font-weight:600}
.form-group{margin-bottom:18px}
input,select{
width:100%;padding:16px;
font-size:1.35em;border-radius:14px;
border:2px solid #e0e0e0}
button{
width:100%;padding:18px;
font-size:1.25em;border-radius:16px;
border:none;font-weight:600;
background:linear-gradient(135deg,#667eea,#764ba2);
color:#fff}

.btn-secondary{background:#6c757d}

/* ---------- Theme selector ---------- */
.theme-select{
display:grid;
grid-template-columns:repeat(3,1fr);
gap:10px;margin-top:10px}

.theme-btn{
padding:12px;
border-radius:14px;
border:3px solid #ddd;
text-align:center;
cursor:pointer;
font-weight:600;
background:#f8f8f8}

.theme-btn.active{
border-color:#667eea;
background:#eef1ff}

/* ---------- Certificate ---------- */
.certificate{
position:relative;
padding:36px 24px;
border-radius:20px;
text-align:center;
overflow:hidden}

.theme-thai{
background:#fffaf0;
border:10px double #c19a6b}

.theme-modern{
background:linear-gradient(135deg,#f3f4f6,#e5e7eb);
border:6px solid #6366f1}

.theme-nature{
background:linear-gradient(135deg,#f0fdf4,#dcfce7);
border:6px solid #22c55e}

.cert-header{font-weight:bold}
.cert-body{line-height:1.9}
.cert-name{font-weight:bold}
.cert-amount{font-weight:bold}
.cert-footer{margin-top:28px;color:#555}

/* ---------- Utility ---------- */
.hidden{display:none}
.button-group{
display:grid;
grid-template-columns:1fr 1fr;
gap:12px;margin-top:18px}
</style>
</head>

<body>
<div class="container">

<!-- FORM -->
<div class="card" id="formSection">
<h2 style="text-align:center;color:#764ba2">üôè ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡πÇ‡∏°‡∏ó‡∏ô‡∏≤‡∏ö‡∏±‡∏ï‡∏£</h2>

<div class="form-group">
<label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
<input id="donorName">
</div>

<div class="form-group">
<label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
<input id="amount" type="number">
</div>

<div class="form-group">
<label>‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå</label>
<select id="purpose"></select>
</div>

<button onclick="saveDonation()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏ö‡∏∏‡∏ç</button>
</div>

<!-- THEME + PREVIEW -->
<div class="card hidden" id="themeSection">
<div class="form-group">
<label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡πÇ‡∏°‡∏ó‡∏ô‡∏≤‡∏ö‡∏±‡∏ï‡∏£</label>
<div class="theme-select">
<div class="theme-btn active" data-theme="theme-thai">üü° ‡∏•‡∏≤‡∏¢‡πÑ‡∏ó‡∏¢</div>
<div class="theme-btn" data-theme="theme-modern">üü£ ‡∏ó‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏¢</div>
<div class="theme-btn" data-theme="theme-nature">üåø ‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥</div>
</div>
</div>

<button onclick="previewCert()">üëÄ ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡πÇ‡∏°‡∏ó‡∏ô‡∏≤‡∏ö‡∏±‡∏ï‡∏£</button>
</div>

<!-- PREVIEW -->
<div class="card hidden" id="previewSection">
<div id="certificate" class="certificate theme-thai"></div>

<div class="button-group">
<button onclick="saveImage()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û</button>
<button class="btn-secondary" onclick="newDonation()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</button>
</div>
</div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
const scriptUrl="https://script.google.com/macros/s/AKfycby9pH_JP8PpdGWzazdTjZw72hhsKnj_Uzd0TI-kHidhuK7qI4vmPMq-CspmaoHcKITQ/exec";

let selectedTheme="theme-thai";
let config={headerSize:2.4,bodySize:1.35,nameSize:1.7,amountSize:2,footerSize:1.2};

/* ---------- Load ---------- */
window.onload=()=>{
loadPurposes();
loadConfig();
};

/* ---------- Purpose ---------- */
async function loadPurposes(){
const r=await fetch(scriptUrl+"?action=getPurposes");
const d=await r.json();
const s=document.getElementById("purpose");
s.innerHTML="";
(d.purposes||[]).forEach(p=>{
const o=document.createElement("option");
o.value=o.textContent=p;
s.appendChild(o);
});
}

/* ---------- Config ---------- */
async function loadConfig(){
try{
const r=await fetch(scriptUrl+"?action=getConfig");
const d=await r.json();
if(d.config)config={...config,...d.config};
}catch(e){}
}

/* ---------- Save donation ---------- */
function saveDonation(){
if(!donorName.value||!amount.value){
alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
return;
}
const fd=new FormData();
fd.append("name",donorName.value);
fd.append("amount",amount.value);
fd.append("purpose",purpose.value);
fetch(scriptUrl,{method:"POST",body:fd});
formSection.classList.add("hidden");
themeSection.classList.remove("hidden");
}

/* ---------- Theme ---------- */
document.querySelectorAll(".theme-btn").forEach(b=>{
b.onclick=()=>{
document.querySelectorAll(".theme-btn").forEach(x=>x.classList.remove("active"));
b.classList.add("active");
selectedTheme=b.dataset.theme;
};
});

/* ---------- Preview ---------- */
function previewCert(){
const c=document.getElementById("certificate");
c.className="certificate "+selectedTheme;
c.innerHTML=`
<div class="cert-header" style="font-size:${config.headerSize}em">
‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡πÇ‡∏°‡∏ó‡∏ô‡∏≤‡∏ö‡∏±‡∏ï‡∏£
</div>
<div class="cert-body" style="font-size:${config.bodySize}em">
‡∏Ç‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏±‡∏Å‡∏Ç‡∏µ‡∏û‡∏¢‡∏≤‡∏ô‡∏ß‡πà‡∏≤
<div class="cert-name" style="font-size:${config.nameSize}em">
${donorName.value}
</div>
‡πÑ‡∏î‡πâ‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏≥‡∏ö‡∏∏‡∏ç ${purpose.value}
<div class="cert-amount" style="font-size:${config.amountSize}em">
${Number(amount.value).toLocaleString()} ‡∏ö‡∏≤‡∏ó
</div>
‡∏Ç‡∏≠‡∏≠‡∏≤‡∏ô‡∏¥‡∏™‡∏á‡∏™‡πå‡πÅ‡∏´‡πà‡∏á‡∏ö‡∏∏‡∏ç‡∏ô‡∏µ‡πâ
</div>
<div class="cert-footer" style="font-size:${config.footerSize}em">
‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${new Date().toLocaleDateString("th-TH")}
<br>üôè ‡∏™‡∏≤‡∏ò‡∏∏ üôè
</div>
`;
themeSection.classList.add("hidden");
previewSection.classList.remove("hidden");
}

/* ---------- Image ---------- */
function saveImage(){
html2canvas(certificate,{scale:2}).then(c=>{
const a=document.createElement("a");
a.download="‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡πÇ‡∏°‡∏ó‡∏ô‡∏≤‡∏ö‡∏±‡∏ï‡∏£.png";
a.href=c.toDataURL();
a.click();
});
}

/* ---------- New ---------- */
function newDonation(){
donorName.value="";
amount.value="";
formSection.classList.remove("hidden");
previewSection.classList.add("hidden");
}
</script>
</body>
</html>
