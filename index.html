<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ใบอนุโมทนาบัตร</title>

<style>
body{font-family:sans-serif;background:#f3f4f6;padding:20px}
.card{background:#fff;padding:20px;border-radius:16px;max-width:500px;margin:auto}
input,select,button{width:100%;padding:12px;margin-top:10px;font-size:16px}
button{background:#6366f1;color:#fff;border:none;border-radius:12px}
.top-admin{position:fixed;top:10px;right:10px}
.hidden{display:none}
</style>
</head>

<body>

<div class="top-admin">
<button onclick="openLogin()">⚙️ Admin</button>
</div>

<!-- FORM -->
<div class="card" id="form">
<h3>ทำบุญ</h3>
<input id="name" placeholder="ชื่อผู้ทำบุญ">
<input id="amount" type="number" placeholder="จำนวนเงิน">
<select id="purpose"></select>
<button onclick="save()">บันทึก</button>
</div>

<!-- LOGIN -->
<div class="card hidden" id="login">
<h3>Admin Login</h3>
<input id="user" placeholder="Username">
<input id="pass" type="password" placeholder="Password">
<button onclick="login()">เข้าสู่ระบบ</button>
</div>

<!-- ADMIN -->
<div class="card hidden" id="admin">
<h3>จัดการวัตถุประสงค์</h3>
<input id="newPurpose" placeholder="เพิ่มวัตถุประสงค์">
<button onclick="add()">เพิ่ม</button>
<ul id="list"></ul>
<button onclick="logout()">ออก</button>
</div>

<script>
const SCRIPT_URL = "ใส่ URL Web App ของคุณตรงนี้";

function openLogin(){
  form.classList.add("hidden");
  login.classList.remove("hidden");
}

async function login(){
  const r = await fetch(`${SCRIPT_URL}?action=login&user=${user.value}&pass=${pass.value}`);
  const d = await r.json();
  if(d.success){
    login.classList.add("hidden");
    admin.classList.remove("hidden");
    loadAdmin();
  } else alert("Login ไม่ถูกต้อง");
}

async function loadAdmin(){
  const r = await fetch(`${SCRIPT_URL}?action=getPurposes`);
  const d = await r.json();
  list.innerHTML="";
  d.purposes.forEach((p,i)=>{
    list.innerHTML+=`<li>${p} <button onclick="del(${i+2})">ลบ</button></li>`;
  });
}

async function add(){
  await fetch(SCRIPT_URL,{method:"POST",body:new URLSearchParams({
    action:"addPurpose",purpose:newPurpose.value
  })});
  newPurpose.value="";
  loadAdmin();
}

async function del(row){
  await fetch(SCRIPT_URL,{method:"POST",body:new URLSearchParams({
    action:"deletePurpose",row
  })});
  loadAdmin();
}

function logout(){
  admin.classList.add("hidden");
  form.classList.remove("hidden");
}

async function loadPurposes(){
  const r = await fetch(`${SCRIPT_URL}?action=getPurposes`);
  const d = await r.json();
  purpose.innerHTML="";
  d.purposes.forEach(p=>purpose.innerHTML+=`<option>${p}</option>`);
}

async function save(){
  await fetch(SCRIPT_URL,{method:"POST",body:new URLSearchParams({
    action:"saveDonation",
    name:name.value,
    amount:amount.value,
    purpose:purpose.value
  })});
  alert("บันทึกแล้ว");
}

loadPurposes();
</script>
</body>
</html>
