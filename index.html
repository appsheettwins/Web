<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡πÇ‡∏°‡∏ó‡∏ô‡∏≤‡∏ö‡∏±‡∏ï‡∏£</title>

<style>
*{box-sizing:border-box;font-family:'Sarabun','Segoe UI',sans-serif}
body{
background:linear-gradient(135deg,#667eea,#764ba2);
padding:14px;min-height:100vh}

.container{max-width:820px;margin:auto}

/* ---------- Card ---------- */
.card{
background:#fff;border-radius:22px;
padding:28px;margin-bottom:20px;
box-shadow:0 20px 45px rgba(0,0,0,.25)}

/* ---------- Form ---------- */
label{font-size:1.15em;font-weight:600}
.form-group{margin-bottom:18px}
input,select{
width:100%;padding:16px;
font-size:1.35em;border-radius:14px;
border:2px solid #e0e0e0}
button{
width:100%;padding:18px;
font-size:1.35em;border-radius:16px;
border:none;font-weight:600;
background:linear-gradient(135deg,#667eea,#764ba2);
color:#fff}

/* ---------- Certificate ---------- */
.certificate{
position:relative;
padding:36px 24px;
border-radius:20px;
text-align:center;
background:#fffaf0;
border:10px double #c19a6b;
overflow:hidden}

/* ‡∏•‡∏≤‡∏¢‡πÑ‡∏ó‡∏¢ */
.certificate::before,
.certificate::after{
content:"";
position:absolute;
width:140px;height:140px;
background:
radial-gradient(circle at 30% 30%,#c19a6b 20%,transparent 21%),
radial-gradient(circle at 70% 70%,#c19a6b 20%,transparent 21%);
opacity:.15}

.certificate::before{top:-30px;left:-30px}
.certificate::after{bottom:-30px;right:-30px}

.cert-header{color:#8b4513;font-weight:bold}
.cert-body{line-height:1.9}
.cert-name{font-weight:bold;color:#8b4513}
.cert-amount{font-weight:bold;color:#d4af37}
.cert-footer{margin-top:28px;color:#555}

/* ---------- Utility ---------- */
.hidden{display:none}
.button-group{
display:grid;grid-template-columns:1fr 1fr;
gap:12px;margin-top:18px}
.btn-secondary{background:#6c757d}
</style>
</head>

<body>
<div class="container">

<!-- FORM -->
<div class="card" id="formSection">
<h2 style="text-align:center;color:#764ba2">üôè ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡πÇ‡∏°‡∏ó‡∏ô‡∏≤‡∏ö‡∏±‡∏ï‡∏£</h2>

<div class="form-group">
<label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
<input id="donorName">
</div>

<div class="form-group">
<label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
<input id="amount" type="number">
</div>

<div class="form-group">
<label>‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå</label>
<select id="purpose">
<option>‡∏ó‡∏≥‡∏ö‡∏∏‡∏ç‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
<option>‡∏ñ‡∏ß‡∏≤‡∏¢‡∏™‡∏±‡∏á‡∏Ü‡∏ó‡∏≤‡∏ô</option>
<option>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏®‡∏≤‡∏™‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô</option>
</select>
</div>

<button onclick="previewCert()">üëÄ ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡πÇ‡∏°‡∏ó‡∏ô‡∏≤‡∏ö‡∏±‡∏ï‡∏£</button>
</div>

<!-- PREVIEW -->
<div class="card hidden" id="previewSection">
<div id="certificate" class="certificate"></div>

<div class="button-group">
<button onclick="saveImage()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û</button>
<button class="btn-secondary" onclick="backForm()">‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö</button>
</div>
</div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
const scriptUrl="https://script.google.com/macros/s/AKfycby9pH_JP8PpdGWzazdTjZw72hhsKnj_Uzd0TI-kHidhuK7qI4vmPMq-CspmaoHcKITQ/exec";
let config={
headerSize:2.4,
bodySize:1.35,
nameSize:1.7,
amountSize:2.0,
footerSize:1.2
};

window.onload=loadConfig;

/* ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å Sheet */
async function loadConfig(){
try{
const r=await fetch(scriptUrl+"?action=getConfig");
const d=await r.json();
if(d.config){config={...config,...d.config}}
}catch(e){console.log("‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô")}
}

function previewCert(){
const c=document.getElementById("certificate");
c.innerHTML=`
<div class="cert-header" style="font-size:${config.headerSize}em">
‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡πÇ‡∏°‡∏ó‡∏ô‡∏≤‡∏ö‡∏±‡∏ï‡∏£
</div>

<div class="cert-body" style="font-size:${config.bodySize}em">
‡∏Ç‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏±‡∏Å‡∏Ç‡∏µ‡∏û‡∏¢‡∏≤‡∏ô‡∏ß‡πà‡∏≤
<div class="cert-name" style="font-size:${config.nameSize}em">
${donorName.value}
</div>
‡πÑ‡∏î‡πâ‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏≥‡∏ö‡∏∏‡∏ç ${purpose.value}
<div class="cert-amount" style="font-size:${config.amountSize}em">
${Number(amount.value).toLocaleString()} ‡∏ö‡∏≤‡∏ó
</div>
‡∏Ç‡∏≠‡∏≠‡∏≤‡∏ô‡∏¥‡∏™‡∏á‡∏™‡πå‡πÅ‡∏´‡πà‡∏á‡∏ö‡∏∏‡∏ç‡∏ô‡∏µ‡πâ
‡∏à‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÅ‡∏´‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏à‡∏£‡∏¥‡∏ç
</div>

<div class="cert-footer" style="font-size:${config.footerSize}em">
‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${new Date().toLocaleDateString("th-TH")}
<br>üôè ‡∏™‡∏≤‡∏ò‡∏∏ üôè
</div>
`;
formSection.classList.add("hidden");
previewSection.classList.remove("hidden");

/* ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Sheet (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) */
const fd=new FormData();
fd.append("name",donorName.value);
fd.append("amount",amount.value);
fd.append("purpose",purpose.value);
fetch(scriptUrl,{method:"POST",body:fd});
}

function saveImage(){
html2canvas(certificate,{scale:2}).then(canvas=>{
const a=document.createElement("a");
a.download="‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡πÇ‡∏°‡∏ó‡∏ô‡∏≤‡∏ö‡∏±‡∏ï‡∏£.png";
a.href=canvas.toDataURL("image/png");
a.click();
});
}

function backForm(){
previewSection.classList.add("hidden");
formSection.classList.remove("hidden");
}
</script>
</body>
</html>
