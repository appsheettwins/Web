<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡πÇ‡∏°‡∏ó‡∏ô‡∏≤‡∏ö‡∏±‡∏ï‡∏£</title>

<style>
*{box-sizing:border-box;font-family:'Sarabun','Segoe UI',sans-serif}
body{
background:linear-gradient(135deg,#667eea,#764ba2);
padding:14px;min-height:100vh}

.container{max-width:820px;margin:auto}

/* ---------- Card ---------- */
.card{
background:#fff;border-radius:22px;
padding:28px;margin-bottom:20px;
box-shadow:0 20px 45px rgba(0,0,0,.25)}

/* ---------- Form ---------- */
label{font-size:1.15em;font-weight:600}
.form-group{margin-bottom:18px}
input,select{
width:100%;padding:16px;
font-size:1.35em;border-radius:14px;
border:2px solid #e0e0e0}
button{
width:100%;padding:18px;
font-size:1.35em;border-radius:16px;
border:none;font-weight:600;
background:linear-gradient(135deg,#667eea,#764ba2);
color:#fff}

/* ---------- Theme selector ---------- */
.theme-select{
display:grid;
grid-template-columns:repeat(3,1fr);
gap:10px;margin-top:10px}

.theme-btn{
padding:12px;
border-radius:14px;
border:3px solid #ddd;
text-align:center;
cursor:pointer;
font-weight:600;
background:#f8f8f8}

.theme-btn.active{
border-color:#667eea;
background:#eef1ff}

/* ---------- Certificate Base ---------- */
.certificate{
position:relative;
padding:36px 24px;
border-radius:20px;
text-align:center;
overflow:hidden}

/* ---------- THEME 1 : Thai Elegant ---------- */
.theme-thai{
background:#fffaf0;
border:10px double #c19a6b}
.theme-thai::before,
.theme-thai::after{
content:"";
position:absolute;
width:150px;height:150px;
background:
radial-gradient(circle at 30% 30%,#c19a6b 20%,transparent 21%),
radial-gradient(circle at 70% 70%,#c19a6b 20%,transparent 21%);
opacity:.15}
.theme-thai::before{top:-30px;left:-30px}
.theme-thai::after{bottom:-30px;right:-30px}

/* ---------- THEME 2 : Modern ---------- */
.theme-modern{
background:linear-gradient(135deg,#f3f4f6,#e5e7eb);
border:6px solid #6366f1}
.theme-modern .cert-header{color:#3730a3}
.theme-modern .cert-name{color:#111827}
.theme-modern .cert-amount{color:#4f46e5}

/* ---------- THEME 3 : Nature ---------- */
.theme-nature{
background:linear-gradient(135deg,#f0fdf4,#dcfce7);
border:6px solid #22c55e}
.theme-nature .cert-header{color:#166534}
.theme-nature .cert-name{color:#14532d}
.theme-nature .cert-amount{color:#15803d}

/* ---------- Certificate Text ---------- */
.cert-header{font-weight:bold}
.cert-body{line-height:1.9}
.cert-name{font-weight:bold}
.cert-amount{font-weight:bold}
.cert-footer{margin-top:28px;color:#555}

/* ---------- Utility ---------- */
.hidden{display:none}
.button-group{
display:grid;grid-template-columns:1fr 1fr;
gap:12px;margin-top:18px}
.btn-secondary{background:#6c757d}
</style>
</head>

<body>
<div class="container">

<!-- FORM -->
<div class="card" id="formSection">
<h2 style="text-align:center;color:#764ba2">üôè ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡πÇ‡∏°‡∏ó‡∏ô‡∏≤‡∏ö‡∏±‡∏ï‡∏£ (V2)</h2>

<div class="form-group">
<label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
<input id="donorName">
</div>

<div class="form-group">
<label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
<input id="amount" type="number">
</div>

<div class="form-group">
<label>‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå</label>
<select id="purpose">
<option>‡∏ó‡∏≥‡∏ö‡∏∏‡∏ç‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
<option>‡∏ñ‡∏ß‡∏≤‡∏¢‡∏™‡∏±‡∏á‡∏Ü‡∏ó‡∏≤‡∏ô</option>
<option>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏®‡∏≤‡∏™‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô</option>
</select>
</div>

<div class="form-group">
<label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡πÇ‡∏°‡∏ó‡∏ô‡∏≤‡∏ö‡∏±‡∏ï‡∏£</label>
<div class="theme-select">
<div class="theme-btn active" data-theme="theme-thai">üü° ‡∏•‡∏≤‡∏¢‡πÑ‡∏ó‡∏¢</div>
<div class="theme-btn" data-theme="theme-modern">üü£ ‡∏ó‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏¢</div>
<div class="theme-btn" data-theme="theme-nature">üåø ‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥</div>
</div>
</div>

<button onclick="previewCert()">üëÄ ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡πÇ‡∏°‡∏ó‡∏ô‡∏≤‡∏ö‡∏±‡∏ï‡∏£</button>
</div>

<!-- PREVIEW -->
<div class="card hidden" id="previewSection">
<div id="certificate" class="certificate theme-thai"></div>

<div class="button-group">
<button onclick="saveImage()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û</button>
<button class="btn-secondary" onclick="backForm()">‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö</button>
</div>
</div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
const scriptUrl="https://script.google.com/macros/s/AKfycby9pH_JP8PpdGWzazdTjZw72hhsKnj_Uzd0TI-kHidhuK7qI4vmPMq-CspmaoHcKITQ/exec";

let config={
headerSize:2.4,
bodySize:1.35,
nameSize:1.7,
amountSize:2.0,
footerSize:1.2
};

let selectedTheme="theme-thai";

/* theme click */
document.querySelectorAll(".theme-btn").forEach(btn=>{
btn.onclick=()=>{
document.querySelectorAll(".theme-btn").forEach(b=>b.classList.remove("active"));
btn.classList.add("active");
selectedTheme=btn.dataset.theme;
};
});

window.onload=loadConfig;

async function loadConfig(){
try{
const r=await fetch(scriptUrl+"?action=getConfig");
const d=await r.json();
if(d.config){config={...config,...d.config}}
}catch(e){}
}

function previewCert(){
const c=document.getElementById("certificate");
c.className="certificate "+selectedTheme;

c.innerHTML=`
<div class="cert-header" style="font-size:${config.headerSize}em">
‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡πÇ‡∏°‡∏ó‡∏ô‡∏≤‡∏ö‡∏±‡∏ï‡∏£
</div>

<div class="cert-body" style="font-size:${config.bodySize}em">
‡∏Ç‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏±‡∏Å‡∏Ç‡∏µ‡∏û‡∏¢‡∏≤‡∏ô‡∏ß‡πà‡∏≤
<div class="cert-name" style="font-size:${config.nameSize}em">
${donorName.value}
</div>
‡πÑ‡∏î‡πâ‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏≥‡∏ö‡∏∏‡∏ç ${purpose.value}
<div class="cert-amount" style="font-size:${config.amountSize}em">
${Number(amount.value).toLocaleString()} ‡∏ö‡∏≤‡∏ó
</div>
‡∏Ç‡∏≠‡∏≠‡∏≤‡∏ô‡∏¥‡∏™‡∏á‡∏™‡πå‡πÅ‡∏´‡πà‡∏á‡∏ö‡∏∏‡∏ç‡∏ô‡∏µ‡πâ
‡∏à‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÅ‡∏´‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏à‡∏£‡∏¥‡∏ç
</div>

<div class="cert-footer" style="font-size:${config.footerSize}em">
‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${new Date().toLocaleDateString("th-TH")}
<br>üôè ‡∏™‡∏≤‡∏ò‡∏∏ üôè
</div>
`;

formSection.classList.add("hidden");
previewSection.classList.remove("hidden");

/* ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Sheet ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° */
const fd=new FormData();
fd.append("name",donorName.value);
fd.append("amount",amount.value);
fd.append("purpose",purpose.value);
fetch(scriptUrl,{method:"POST",body:fd});
}

function saveImage(){
html2canvas(certificate,{scale:2}).then(canvas=>{
const a=document.createElement("a");
a.download="‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡πÇ‡∏°‡∏ó‡∏ô‡∏≤‡∏ö‡∏±‡∏ï‡∏£.png";
a.href=canvas.toDataURL("image/png");
a.click();
});
}

function backForm(){
previewSection.classList.add("hidden");
formSection.classList.remove("hidden");
}
</script>
</body>
</html>
