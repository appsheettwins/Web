<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500&display=swap" rel="stylesheet">
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { background-color: #f0f2f5; font-family: 'Kanit', sans-serif; padding: 20px; }
        .card-main { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 8px 24px rgba(0,0,0,0.1); max-width: 450px; margin: auto; }
        .hidden { display: none !important; }
        .summary-box { background: #f0fff4; border-left: 6px solid #22c55e; padding: 15px; border-radius: 12px; margin-bottom: 20px; }
        .btn-add-new { background-color: #007bff; color: white; font-weight: bold; border: none; padding: 15px; border-radius: 10px; width: 100%; transition: 0.2s; box-shadow: 0 4px 6px rgba(0,123,255,0.3); }
        label { font-weight: 500; color: #444; margin-bottom: 5px; }
    </style>
</head>
<body>

<div class="card-main">
    <div id="section-form">
        <h4 class="text-center mb-4">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h4>
        <form id="mainForm" onsubmit="event.preventDefault(); handleForm(this);">
            
            <input type="hidden" name="lineUserId" id="lineUserId" value="N/A">

            <div class="mb-3">
                <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                <input type="text" name="name" class="form-control" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" required>
            </div>
            <div class="mb-3">
                <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                <input type="tel" name="phone" class="form-control" placeholder="08x-xxxxxxx" required>
            </div>
            <div class="mb-3">
                <label>‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
                <select name="option" id="main-opt" class="form-select" onchange="updateSub(this.value)" required>
                    <option value="" disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°...</option>
                    <option value="‡∏ò‡∏£‡∏£‡∏°‡∏¢‡∏≤‡∏ï‡∏£‡∏≤">‡∏ò‡∏£‡∏£‡∏°‡∏¢‡∏≤‡∏ï‡∏£‡∏≤</option>
                    <option value="‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏ó‡∏µ‡∏õ">‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏ó‡∏µ‡∏õ</option>
                    <option value="‡∏ï‡∏±‡∏Å‡∏ö‡∏≤‡∏ï‡∏£">‡∏ï‡∏±‡∏Å‡∏ö‡∏≤‡∏ï‡∏£</option>
                </select>
            </div>
            <div class="mb-3">
                <label>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏¢</label>
                <select name="sub_option" id="sub-opt" class="form-select" required disabled>
                    <option value="">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡πà‡∏≠‡∏ô</option>
                </select>
            </div>
            <div class="mb-3">
                <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
                <textarea name="details" class="form-control" rows="2" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)"></textarea>
            </div>
            
            <button type="submit" id="submitBtn" class="btn btn-success w-100 p-2 mt-2 fw-bold">
                ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            </button>
            <div id="lineStatus" class="text-center small mt-2 text-muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LINE...</div>
        </form>
    </div>

    <div id="section-loading" class="hidden text-center py-5">
        <div class="spinner-border text-primary" role="status"></div>
        <p class="mt-3 text-muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
    </div>

    <div id="section-success" class="hidden">
        <div class="text-center mb-4">
            <h3 class="text-success fw-bold">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
        </div>
        <div class="summary-box">
            <p class="mb-2"><strong>üë§ ‡∏ä‡∏∑‡πà‡∏≠:</strong> <span id="view-name"></span></p>
            <p class="mb-2"><strong>üìû ‡πÄ‡∏ö‡∏≠‡∏£‡πå:</strong> <span id="view-phone"></span></p> 
            <p class="mb-0"><strong>üìç ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</strong> <span id="view-sub"></span></p>
        </div>
        <button type="button" onclick="backToForm()" class="btn-add-new shadow">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà</button>
    </div>
</div>

<script>

    const subData = {
        '‡∏ò‡∏£‡∏£‡∏°‡∏¢‡∏≤‡∏ï‡∏£‡∏≤': ['3 ‡∏°.‡∏Ñ. ‡πÇ‡∏•‡∏ï‡∏±‡∏™‡πÅ‡∏•‡∏ô‡∏î‡πå', '7 ‡∏°.‡∏Ñ. ‡∏Ñ‡∏•‡∏≠‡∏á‡∏ö‡∏≤‡∏á‡∏ô‡∏≤‡∏á‡πÅ‡∏ó‡πà‡∏ô', '11 ‡∏°.‡∏Ñ. ‡∏ß‡∏±‡∏î‡∏™‡∏≠‡∏á‡∏û‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏á', '14 ‡∏°.‡∏Ñ. ‡∏ß‡∏±‡∏î‡πÇ‡∏ö‡∏™‡∏ñ‡πå‡∏ö‡∏ô','18 ‡∏°.‡∏Ñ. ‡∏ö‡∏≤‡∏á‡∏õ‡∏•‡∏≤'],
        '‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏ó‡∏µ‡∏õ': ['B1', 'B2', 'B3'],
        '‡∏ï‡∏±‡∏Å‡∏ö‡∏≤‡∏ï‡∏£': ['C1', 'C2', 'C3', 'C4', 'C5']
    };

async function initLiff() {
    try {
        await liff.init({ liffId: "2008933743-UuRrgT1t" });

        if (!liff.isLoggedIn()) {
            liff.login();
            return;
        }

        const profile = await liff.getProfile();
        document.getElementById('lineUserId').value = profile.userId;
        document.getElementById('lineStatus').innerText = '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LINE ‡πÅ‡∏•‡πâ‡∏ß';

    } catch (err) {
        document.getElementById('lineStatus').innerText = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LINE';
        console.error(err);
    }
}

window.onload = initLiff;

    function updateSub(val) {
        const sub = document.getElementById('sub-opt');
        sub.innerHTML = '<option value="" disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏¢...</option>';
        if (subData[val]) {
            sub.disabled = false;
            subData[val].forEach(i => sub.add(new Option(i, i)));
        }
    }

    function handleForm(form) {
        document.getElementById('view-name').innerText = form.name.value;
        document.getElementById('view-phone').innerText = form.phone.value;
        document.getElementById('view-sub').innerText = form.sub_option.value;

        document.getElementById('section-form').classList.add('hidden');
        document.getElementById('section-loading').classList.remove('hidden');

        google.script.run
            .withSuccessHandler(() => {
                document.getElementById('section-loading').classList.add('hidden');
                document.getElementById('section-success').classList.remove('hidden');
            })
            .withFailureHandler(err => {
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err);
                document.getElementById('section-loading').classList.add('hidden');
                document.getElementById('section-form').classList.remove('hidden');
            })
            .processForm(form);
    }

    function backToForm() {
        document.getElementById('mainForm').reset();
        document.getElementById('sub-opt').disabled = true;
        document.getElementById('section-success').classList.add('hidden');
        document.getElementById('section-form').classList.remove('hidden');
    }
</script>
</body>
</html>
